<html>
<head>
    <title>RPG</title>
    <script src=https://code.jquery.com/jquery-3.6.0.min.js></script>
    <link href="/css/my.css" rel="stylesheet">
</head>
<body>
<h1>RPG admin panel</h1>
<h2>Accounts list:</h2>
Count per page: <label>
    <select>
        <option value="3">3</option>
        <option value="7">7</option>
        <option value="15">15</option>
        <option value="20">20</option>
    </select>
</label>

<table id="table" class="table">
    <tr>
        <th>#</th>
        <th>Name</th>
        <th>Title</th>
        <th>Race</th>
        <th>Profession</th>
        <th>Level</th>
        <th>Birthday</th>
        <th>Banned</th>
        <th>Edit</th>
        <th>Delete</th>
    </tr>
</table>
<div id="paging" class="paging">
    Pages:
</div>
<script>

    const selectedPageSize = $('select');
    function showAccountsPerPage(pageNumber) {
        document.querySelectorAll('#paging button').forEach(button => {
            button.remove();
        });
        $.get("/rest/players/count").then(accountSize => {
            const pageSize = selectedPageSize.val();
            clearTable();
            showPlayers(pageNumber, pageSize);
            const pages = Math.ceil(accountSize / pageSize);
            for (let i = 0; i < pages; i++) {
                const button = document.createElement('button');
                button.textContent = "" + (i + 1);
                button.id = "button-" + i;
                button.addEventListener('click', () => {
                    showPlayers(i, pageSize);
                });
                document.getElementById('paging').appendChild(button);

            }
        }).catch(error => {
            console.error("Error fetching account count:", error)
        })
    }
    function showPlayers(pageNumber, pageSize) {
        $.get("/rest/players", {pageNumber, pageSize}).then(players => {
            changePageButtonColor(pageNumber);
            clearTable();
            players.forEach((player) => {
                const row = document.createElement('tr');

                row.innerHTML = `
                    <tr>
                        <td>${player.id}</td>
                        <td>${player.name}</td>
                        <td>${player.title}</td>
                        <td>${player.race}</td>
                        <td>${player.profession}</td>
                        <td>${player.level}</td>
                        <td>${new Date(player.birthday).toLocaleDateString()}</td>
                        <td>${player.banned ? 'Yes' : 'No'}</td>
                    </tr>
                `;

                const editCell = document.createElement("td");
                const deleteCell = document.createElement("td");
                const editButton = createButton("edit");
                const deleteButton = createButton("delete");
                deleteButton.addEventListener("click", ()=> {
                    deletePlayer(player.id, pageNumber);
                });

                editCell.appendChild(editButton);
                deleteCell.appendChild(deleteButton);

                row.appendChild(editCell);
                row.appendChild(deleteCell);
                document.getElementById("table").appendChild(row);
            });
        }).catch(error => {
            console.error("Error fetching players:", error);
        });
    }
    function deletePlayer(id, pageNumber) {
        $.ajax({
            type: "DELETE",
            url: `/rest/players/${id}`,
        }).then(() => {
            showAccountsPerPage(pageNumber);
            console.log(`Player with ID ${id} deleted successfully.`);
        }).catch(error => {
            console.error("Error deleting player with id: " + id, error);
        });
    }
    function changePageButtonColor(pageNumber) {
        document.querySelectorAll('#paging button').forEach(button => {
            $(button).css('color', 'black')
        })
        $('#button-' + pageNumber).css('color', 'red')
    }
    function createButton (buttonName) {
        const button = document.createElement("button");
        button.className = buttonName + "-button";
        return button;
    }
    function clearTable() {
        document.getElementById("table").innerHTML = `
        <tr>
            <th>#</th>
            <th>Name</th>
            <th>Title</th>
            <th>Race</th>
            <th>Profession</th>
            <th>Level</th>
            <th>Birthday</th>
            <th>Banned</th>
            <th>Edit</th>
            <th>Delete</th>
        </tr>

    `
    }
    function initializePage() {
        clearTable();
        document.getElementById('paging').innerHTML = 'Pages:';
        showAccountsPerPage(0);
        showPlayers(0, selectedPageSize.val());
    }

    selectedPageSize.on('change', initializePage);
    window.onload = initializePage;

</script>

</body>
</html>